//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ramm/git/Ashera/AsheraAndroidParser/src/com/ashera/parser/html/HtmlSaxHandler.java
//


#include "HasText.h"
#include "HasWidgets.h"
#include "HtmlSaxHandler.h"
#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "IWidget.h"
#include "J2ObjC_source.h"
#include "PageData.h"
#include "WidgetFactory.h"
#include "android/util/Log.h"
#include "java/io/PrintStream.h"
#include "java/lang/Boolean.h"
#include "java/lang/RuntimeException.h"
#include "java/lang/StringBuffer.h"
#include "java/lang/System.h"
#include "java/util/ArrayList.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Stack.h"
#include "org/xml/sax/Attributes.h"
#include "org/xml/sax/Locator.h"
#include "org/xml/sax/SAXException.h"

#line 0 "/Users/ramm/git/Ashera/AsheraAndroidParser/src/com/ashera/parser/html/HtmlSaxHandler.java"

@interface ComAsheraParserHtmlHtmlSaxHandler () {
 @public
  ComAsheraWidgetFactoryPageData *pageData_;
  id<ComAsheraWidgetFactoryIWidget> root_;
  id<ComAsheraWidgetFactoryIWidget> widget_;
  JavaUtilStack *hasWidgets_;
  JavaUtilStack *pushParent_;
  id<JavaUtilMap> metadata_;
  id<JavaUtilList> htmlElements_;
  JavaUtilStack *widgetsStack_;
  jboolean isTemplate_;
}

- (NSString *)getNPathWithNSString:(NSString *)localName
           withOrgXmlSaxAttributes:(id<OrgXmlSaxAttributes>)atts;

- (void)setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget:(id<ComAsheraWidgetFactoryIWidget>)widget
                            withComAsheraWidgetFactoryHasWidgets:(id<ComAsheraWidgetFactoryHasWidgets>)parent
                                                    withNSString:(NSString *)localName
                                         withOrgXmlSaxAttributes:(id<OrgXmlSaxAttributes>)atts;

- (NSString *)getNodeExpression;

@end

J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, pageData_, ComAsheraWidgetFactoryPageData *)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, root_, id<ComAsheraWidgetFactoryIWidget>)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, widget_, id<ComAsheraWidgetFactoryIWidget>)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, hasWidgets_, JavaUtilStack *)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, pushParent_, JavaUtilStack *)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, metadata_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, htmlElements_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(ComAsheraParserHtmlHtmlSaxHandler, widgetsStack_, JavaUtilStack *)

__attribute__((unused)) static NSString *ComAsheraParserHtmlHtmlSaxHandler_getNPathWithNSString_withOrgXmlSaxAttributes_(ComAsheraParserHtmlHtmlSaxHandler *self, NSString *localName, id<OrgXmlSaxAttributes> atts);

__attribute__((unused)) static void ComAsheraParserHtmlHtmlSaxHandler_setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget_withComAsheraWidgetFactoryHasWidgets_withNSString_withOrgXmlSaxAttributes_(ComAsheraParserHtmlHtmlSaxHandler *self, id<ComAsheraWidgetFactoryIWidget> widget, id<ComAsheraWidgetFactoryHasWidgets> parent, NSString *localName, id<OrgXmlSaxAttributes> atts);

__attribute__((unused)) static NSString *ComAsheraParserHtmlHtmlSaxHandler_getNodeExpression(ComAsheraParserHtmlHtmlSaxHandler *self);


#line 22
@implementation ComAsheraParserHtmlHtmlSaxHandler


#line 33
- (instancetype)initWithJavaUtilMap:(id<JavaUtilMap>)metadata {
  ComAsheraParserHtmlHtmlSaxHandler_initWithJavaUtilMap_(self, metadata);
  return self;
}


#line 39
- (void)endDocument {
}


#line 43
- (void)endPrefixMappingWithNSString:(NSString *)prefix {
}


#line 47
- (void)ignorableWhitespaceWithCharArray:(IOSCharArray *)ch
                                 withInt:(jint)start
                                 withInt:(jint)length {
}

- (void)processingInstructionWithNSString:(NSString *)target
                             withNSString:(NSString *)data {
}


#line 57
- (void)setDocumentLocatorWithOrgXmlSaxLocator:(id<OrgXmlSaxLocator>)locator {
}


#line 61
- (void)skippedEntityWithNSString:(NSString *)name {
}


#line 65
- (void)startDocument {
}


#line 69
- (void)startPrefixMappingWithNSString:(NSString *)prefix
                          withNSString:(NSString *)uri {
}


#line 75
- (void)charactersWithCharArray:(IOSCharArray *)ch
                        withInt:(jint)start
                        withInt:(jint)length {
  
#line 77
  if (widget_ != nil) {
    NSString *content = [NSString stringWithCharacters:ch offset:start length:length];
    
#line 80
    if (content != nil && ![((NSString *) nil_chk([content trim])) isEqual:@""]) {
      if ([ComAsheraWidgetFactoryHasText_class_() isInstance:widget_]) {
        id<ComAsheraWidgetFactoryHasText> widget2 = (id<ComAsheraWidgetFactoryHasText>) check_protocol_cast(widget_, @protocol(ComAsheraWidgetFactoryHasText));
        
#line 84
        if ([widget2 getText] == nil) {
          [widget2 setTextWithNSString:content];
        }
        else {
          
#line 87
          [widget2 setTextWithNSString:JreStrcat("$$", [widget2 getText], content)];
        }
      }
    }
    
#line 92
    [((JavaIoPrintStream *) nil_chk(JavaLangSystem_get_out_())) printlnWithNSString:JreStrcat("$$", @"content", content)];
  }
}


#line 97
- (void)startElementWithNSString:(NSString *)uri
                    withNSString:(NSString *)localName
                    withNSString:(NSString *)qName
         withOrgXmlSaxAttributes:(id<OrgXmlSaxAttributes>)atts {
  
#line 99
  AndroidUtilLog_eWithNSString_withNSString_(@"layout", localName);
  if (!isTemplate_ && [((NSString *) nil_chk(localName)) isEqual:@"template"]) {
    isTemplate_ = YES;
  }
  [((id<JavaUtilList>) nil_chk(htmlElements_)) addWithId:ComAsheraParserHtmlHtmlSaxHandler_getNPathWithNSString_withOrgXmlSaxAttributes_(self, localName, atts)];
  
#line 105
  self->widget_ = ComAsheraWidgetFactoryWidgetFactory_getWithNSString_withBoolean_(localName, isTemplate_);
  
#line 108
  if ([((NSString *) nil_chk(localName)) isEqual:@"body"] && root_ == nil && widget_ != nil) {
    self->root_ = self->widget_;
    
#line 111
    if (![@"root" isEqual:[((id<OrgXmlSaxAttributes>) nil_chk(atts)) getValueWithNSString:@"id"]]) {
      @throw new_JavaLangRuntimeException_initWithNSString_(@"Id of the root has to be root");
    }
  }
  jboolean parentPushed = NO;
  if (widget_ != nil) {
    (void) [((id<JavaUtilMap>) nil_chk(metadata_)) putWithId:@"localname" withId:localName];
    (void) [metadata_ putWithId:@"uri" withId:uri];
    (void) [metadata_ putWithId:@"qName" withId:qName];
    (void) [metadata_ putWithId:@"attributes" withId:atts];
    [self->widget_ createWithJavaUtilMap:metadata_];
    
#line 123
    id<ComAsheraWidgetFactoryHasWidgets> parent = nil;
    if (![((JavaUtilStack *) nil_chk(hasWidgets_)) isEmpty]) {
      parent = [hasWidgets_ peek];
    }
    
#line 128
    ComAsheraParserHtmlHtmlSaxHandler_setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget_withComAsheraWidgetFactoryHasWidgets_withNSString_withOrgXmlSaxAttributes_(self, widget_, parent, localName, atts);
    
#line 130
    if (parent != nil) {
      if ([widget_ asWidget] != nil) {
        [parent addWithComAsheraWidgetFactoryIWidget:widget_];
      }
    }
    [widget_ setParentWithComAsheraWidgetFactoryHasWidgets:parent];
    
#line 137
    if ([ComAsheraWidgetFactoryHasWidgets_class_() isInstance:widget_]) {
      parentPushed = YES;
      (void) [hasWidgets_ pushWithId:(id<ComAsheraWidgetFactoryHasWidgets>) check_protocol_cast(widget_, @protocol(ComAsheraWidgetFactoryHasWidgets))];
    }
  }
  
#line 143
  [((JavaUtilStack *) nil_chk(pushParent_)) addWithId:JavaLangBoolean_valueOfWithBoolean_(parentPushed)];
  [((JavaUtilStack *) nil_chk(widgetsStack_)) addWithId:widget_];
}


#line 147
- (NSString *)getNPathWithNSString:(NSString *)localName
           withOrgXmlSaxAttributes:(id<OrgXmlSaxAttributes>)atts {
  return ComAsheraParserHtmlHtmlSaxHandler_getNPathWithNSString_withOrgXmlSaxAttributes_(self, localName, atts);
}


#line 175
- (void)setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget:(id<ComAsheraWidgetFactoryIWidget>)widget
                            withComAsheraWidgetFactoryHasWidgets:(id<ComAsheraWidgetFactoryHasWidgets>)parent
                                                    withNSString:(NSString *)localName
                                         withOrgXmlSaxAttributes:(id<OrgXmlSaxAttributes>)atts {
  ComAsheraParserHtmlHtmlSaxHandler_setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget_withComAsheraWidgetFactoryHasWidgets_withNSString_withOrgXmlSaxAttributes_(self, widget, parent, localName, atts);
}


#line 199
- (NSString *)getNodeExpression {
  return ComAsheraParserHtmlHtmlSaxHandler_getNodeExpression(self);
}


#line 211
- (void)endElementWithNSString:(NSString *)uri
                  withNSString:(NSString *)localName
                  withNSString:(NSString *)qName {
  
#line 213
  (void) [htmlElements_ removeWithInt:[((id<JavaUtilList>) nil_chk(htmlElements_)) size] - 1];
  if ([((JavaLangBoolean *) nil_chk([((JavaUtilStack *) nil_chk(pushParent_)) pop])) booleanValue]) {
    (void) [((JavaUtilStack *) nil_chk(hasWidgets_)) pop];
  }
  
#line 218
  if ([((NSString *) nil_chk(localName)) isEqual:@"template"]) {
    isTemplate_ = NO;
  }
  
#line 222
  self->widget_ = [((JavaUtilStack *) nil_chk(widgetsStack_)) pop];
  if (widget_ != nil) {
    [widget_ initialized];
  }
}


#line 228
- (id<ComAsheraWidgetFactoryIWidget>)getRoot {
  return root_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaUtilMap:", "HtmlSaxHandler", NULL, 0x1, NULL, NULL },
    { "endDocument", NULL, "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "endPrefixMappingWithNSString:", "endPrefixMapping", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "ignorableWhitespaceWithCharArray:withInt:withInt:", "ignorableWhitespace", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "processingInstructionWithNSString:withNSString:", "processingInstruction", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "setDocumentLocatorWithOrgXmlSaxLocator:", "setDocumentLocator", "V", 0x1, NULL, NULL },
    { "skippedEntityWithNSString:", "skippedEntity", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "startDocument", NULL, "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "startPrefixMappingWithNSString:withNSString:", "startPrefixMapping", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "charactersWithCharArray:withInt:withInt:", "characters", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "startElementWithNSString:withNSString:withNSString:withOrgXmlSaxAttributes:", "startElement", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "getNPathWithNSString:withOrgXmlSaxAttributes:", "getNPath", "Ljava.lang.String;", 0x2, NULL, NULL },
    { "setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget:withComAsheraWidgetFactoryHasWidgets:withNSString:withOrgXmlSaxAttributes:", "setUpStyleAndAttributes", "V", 0x2, NULL, NULL },
    { "getNodeExpression", NULL, "Ljava.lang.String;", 0x2, NULL, NULL },
    { "endElementWithNSString:withNSString:withNSString:", "endElement", "V", 0x1, "Lorg.xml.sax.SAXException;", NULL },
    { "getRoot", NULL, "Lcom.ashera.widget.factory.IWidget;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "pageData_", NULL, 0x2, "Lcom.ashera.widget.factory.PageData;", NULL, NULL,  },
    { "root_", NULL, 0x2, "Lcom.ashera.widget.factory.IWidget;", NULL, NULL,  },
    { "widget_", NULL, 0x2, "Lcom.ashera.widget.factory.IWidget;", NULL, NULL,  },
    { "hasWidgets_", NULL, 0x2, "Ljava.util.Stack;", NULL, "Ljava/util/Stack<Lcom/ashera/widget/factory/HasWidgets;>;",  },
    { "pushParent_", NULL, 0x2, "Ljava.util.Stack;", NULL, "Ljava/util/Stack<Ljava/lang/Boolean;>;",  },
    { "metadata_", NULL, 0x2, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;",  },
    { "htmlElements_", NULL, 0x2, "Ljava.util.List;", NULL, "Ljava/util/List<Ljava/lang/String;>;",  },
    { "widgetsStack_", NULL, 0x2, "Ljava.util.Stack;", NULL, "Ljava/util/Stack<Lcom/ashera/widget/factory/IWidget;>;",  },
    { "isTemplate_", NULL, 0x2, "Z", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _ComAsheraParserHtmlHtmlSaxHandler = { 2, "HtmlSaxHandler", "com.ashera.parser.html", NULL, 0x1, 16, methods, 9, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComAsheraParserHtmlHtmlSaxHandler;
}

@end


#line 33
void ComAsheraParserHtmlHtmlSaxHandler_initWithJavaUtilMap_(ComAsheraParserHtmlHtmlSaxHandler *self, id<JavaUtilMap> metadata) {
  (void) NSObject_init(self);
  self->pageData_ = new_ComAsheraWidgetFactoryPageData_init();
  self->hasWidgets_ = new_JavaUtilStack_init();
  self->pushParent_ = new_JavaUtilStack_init();
  self->htmlElements_ = new_JavaUtilArrayList_init();
  self->widgetsStack_ = new_JavaUtilStack_init();
  self->isTemplate_ =
#line 31
  NO;
  
#line 34
  self->metadata_ = metadata;
  (void) [((id<JavaUtilMap>) nil_chk(metadata)) putWithId:@"pageData" withId:self->pageData_];
}


#line 33
ComAsheraParserHtmlHtmlSaxHandler *new_ComAsheraParserHtmlHtmlSaxHandler_initWithJavaUtilMap_(id<JavaUtilMap> metadata) {
  ComAsheraParserHtmlHtmlSaxHandler *self = [ComAsheraParserHtmlHtmlSaxHandler alloc];
  ComAsheraParserHtmlHtmlSaxHandler_initWithJavaUtilMap_(self, metadata);
  return self;
}


#line 147
NSString *ComAsheraParserHtmlHtmlSaxHandler_getNPathWithNSString_withOrgXmlSaxAttributes_(ComAsheraParserHtmlHtmlSaxHandler *self, NSString *localName, id<OrgXmlSaxAttributes> atts) {
  JavaLangStringBuffer *stringBuffer = new_JavaLangStringBuffer_init();
  (void) [stringBuffer appendWithNSString:localName];
  NSString *classStr = [((id<OrgXmlSaxAttributes>) nil_chk(atts)) getValueWithNSString:@"class"];
  
#line 152
  JavaLangStringBuffer *classBuffer = new_JavaLangStringBuffer_initWithNSString_(@"");
  if (classStr != nil && ![((NSString *) nil_chk([classStr trim])) isEqual:@""]) {
    IOSObjectArray *classes = [classStr split:@"\\s"];
    for (jint i = 0; i < ((IOSObjectArray *) nil_chk(classes))->size_; i++) {
      (void) [classBuffer appendWithNSString:JreStrcat("C$C", '.', IOSObjectArray_Get(classes, i), '|')];
    }
  }
  
#line 160
  NSString *idStr = [atts getValueWithNSString:@"id"];
  JavaLangStringBuffer *idBuffer = new_JavaLangStringBuffer_initWithNSString_(@"");
  if (idStr != nil && ![((NSString *) nil_chk([idStr trim])) isEqual:@""]) {
    (void) [idBuffer appendWithNSString:JreStrcat("C$C", '#', [idStr trim], '|')];
  }
  
#line 166
  if ([idBuffer length] > 0 || [classBuffer length] > 0) {
    (void) [stringBuffer appendWithNSString:@"["];
    (void) [stringBuffer appendWithNSString:[classBuffer description]];
    (void) [stringBuffer appendWithNSString:[idBuffer description]];
    (void) [stringBuffer appendWithNSString:@"]"];
  }
  return [stringBuffer description];
}


#line 175
void ComAsheraParserHtmlHtmlSaxHandler_setUpStyleAndAttributesWithComAsheraWidgetFactoryIWidget_withComAsheraWidgetFactoryHasWidgets_withNSString_withOrgXmlSaxAttributes_(ComAsheraParserHtmlHtmlSaxHandler *self, id<ComAsheraWidgetFactoryIWidget> widget, id<ComAsheraWidgetFactoryHasWidgets> parent, NSString *localName, id<OrgXmlSaxAttributes> atts) {
  id<JavaUtilMap> cssProperties = [((ComAsheraWidgetFactoryPageData *) nil_chk(self->pageData_)) getCssWithNSString:ComAsheraParserHtmlHtmlSaxHandler_getNodeExpression(self) withNSString:
#line 177
  localName withNSString:[((id<OrgXmlSaxAttributes>) nil_chk(atts)) getValueWithNSString:@"class"] withNSString:[atts getValueWithNSString:@"id"]];
  [((id<ComAsheraWidgetFactoryIWidget>) nil_chk(widget)) setUpStyleWithJavaUtilMap:cssProperties];
  IOSObjectArray *attr = [widget getAttributes];
  IOSObjectArray *layoutAttrs = nil;
  if (parent != nil) {
    layoutAttrs = [parent getLayoutAttributes];
  }
  
#line 185
  id<JavaUtilMap> attributes = new_JavaUtilHashMap_init();
  if (attr != nil) {
    for (jint i = 0; i < attr->size_; i++) {
      (void) [attributes putWithId:IOSObjectArray_Get(attr, i) withId:[atts getValueWithNSString:IOSObjectArray_Get(attr, i)]];
    }
  }
  if (layoutAttrs != nil) {
    for (jint i = 0; i < layoutAttrs->size_; i++) {
      (void) [attributes putWithId:IOSObjectArray_Get(layoutAttrs, i) withId:[atts getValueWithNSString:IOSObjectArray_Get(layoutAttrs, i)]];
    }
  }
  [widget setUpAttributeWithJavaUtilMap:attributes];
}


#line 199
NSString *ComAsheraParserHtmlHtmlSaxHandler_getNodeExpression(ComAsheraParserHtmlHtmlSaxHandler *self) {
  JavaLangStringBuffer *stringBuffer = new_JavaLangStringBuffer_init();
  for (NSString * __strong htmlElement in nil_chk(self->htmlElements_)) {
    (void) [stringBuffer insertWithInt:0 withNSString:JreStrcat("$C", htmlElement, '>')];
  }
  
#line 205
  stringBuffer = [stringBuffer deleteCharAtWithInt:[stringBuffer length] - 1];
  AndroidUtilLog_eWithNSString_withNSString_(@"test", JreStrcat("@", stringBuffer));
  return [((JavaLangStringBuffer *) nil_chk(stringBuffer)) description];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComAsheraParserHtmlHtmlSaxHandler)
